<html lang="en">
    <head>
        <title>Game</title>
        <script src="/socket.io/socket.io.js"></script>
        <style>
            body {
                display: flex;
                flex-direction: column;
                font-family: Verdana, sans-serif;
            }

            
            #score {
                width: 100%;
                display: flex;
                justify-content: center;
                margin: 20px 0 20px 0;
            }
            
            .score-item {
                margin-left: 10px;
            }
            
            #canvas-container {
                display: flex;
                justify-content: center;
            }

            #canvas {
                height: 600px;
                width: 900px;
                border: solid 5px black;
                /* background-color: blue; */
            }
            </style>
    </head>

    <body>
        <div id="score">
            <h2 class="score-item">0</h2>
            <h2 class="score-item">:</h2>
            <h2 class="score-item">0</h2>
        </div>
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
    </body>
    <script>
        class Paddle {
            constructor(canvas, ctx, x, y, width, height, velocity) {
                this.canvas = canvas;
                this.ctx = ctx;
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.velocity = velocity;
            }

            draw() {
                console.log(`x=${this.x} y=${this.y}`);
                this.ctx.fillRect(
                    this.x, 
                    this.y, 
                    this.width, 
                    this.height
                );
            }

            getRealX() {
                return this.x - Math.floor(this.width / 2);
            }

            getRealY() {
                return this.y - Math.floor(this.height / 2);
            }

            up() {
                const y = this.y - this.velocity;

                if ( this.isBound(y) )
                    this.y -= this.velocity;
                else
                    this.y = 0;
            }

            down() {
                const y = this.y + this.velocity;

                if ( this.isBound(y) )
                    this.y = y;
                else
                    this.y = this.canvas.height - this.height;
            }

            isBound(y) {
                return y >= 0 && y < (this.canvas.height - this.height);
            }
        }

        class Game {
            constructor(id) {
                this.canvas = document.getElementById(id);
                this.ctx = this.canvas.getContext("2d");
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                this.middle = { 
                    x: this.width / 2, 
                    y: this.height / 2 
                }
                this.paddleDimension = {
                    width: 5, 
                    height: 25 
                };
                this.paddleVelocity = 5;
                this.paddleMargin = 10;
                this.leftPaddle = new Paddle(
                    this.canvas,
                    this.ctx, 
                    this.getInitPaddleX(this.paddleMargin), 
                    this.getInitPaddleY(this.middle.y),
                    this.paddleDimension.width,
                    this.paddleDimension.height,
                    this.paddleVelocity
                )
                this.rightPaddle = new Paddle(
                    this.canvas,
                    this.ctx,
                    this.getInitPaddleX(this.width - this.paddleMargin),
                    this.getInitPaddleY(this.middle.y),
                    this.paddleDimension.width,
                    this.paddleDimension.height,
                    this.paddleVelocity
                )
            }

            setup() {
                
            }

            update() {
                this.clear();
                this.drawCenterLine();
                this.leftPaddle.draw();
                this.rightPaddle.draw();
            }

            clear() {
                this.ctx.clearRect(0, 0, this.width, this.height);
            }

            drawCenterLine() {
                this.ctx.setLineDash([3, 2]);
                this.ctx.beginPath();
                this.ctx.moveTo(this.middle.x, 0);
                this.ctx.lineTo(this.middle.x, this.height);
                this.ctx.stroke();
            }

            upLeft() {
                console.dir(this.ctx);
                this.leftPaddle.up();
            }

            downLeft() {
                this.leftPaddle.down();
            }

            upRight() {
                this.rightPaddle.up();
            }

            downRight() {
                this.rightPaddle.down();
            }

            getInitPaddleX(x) {
                return x - Math.floor(this.paddleDimension.width / 2);
            }

            getInitPaddleY(y) {
                return y - Math.floor(this.paddleDimension.height / 2);
            }
        }

        const game = new Game("canvas");

        game.setup();

        game.update();
        document.addEventListener("keydown", function(event) {
            if ( event.key == "ArrowUp" ) {
                game.upLeft();
            } else if ( event.key == "ArrowDown" ) {
                game.downLeft();
            } else if ( event.key == "ArrowLeft" ) {
                game.upRight();
            } else if ( event.key == "ArrowRight" ) {
                game.downRight();
            }
            game.update();
        });
    </script>
</html>